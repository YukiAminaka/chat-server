<!DOCTYPE html>
<html>
  <head>
    <title>Goãƒãƒ£ãƒƒãƒˆ</title>
  </head>
  <body>
    <h1>WebSocket Chat</h1>

    <input id="username" type="text" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" />
    <button onclick="connect()">æ¥ç¶š</button>

    <div id="chatUI" style="display: none">
      <input id="msg" type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" />
      <button onclick="sendMessage()">é€ä¿¡</button>
      <ul id="chat"></ul>
    </div>

    <script>
      let ws;

      function connect() {
        const username = document.getElementById("username").value;
        if (!username) return alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        ws = new WebSocket("ws://" + location.host + "/ws");

        ws.onopen = () => {
          ws.send(username);
          document.getElementById("chatUI").style.display = "block";
        };

        ws.onmessage = function (event) {
          const data = JSON.parse(event.data);
          const chat = document.getElementById("chat");
          const li = document.createElement("li");

          if (data.type === "message") {
            li.textContent = `${data.sender}: ${data.content}`;
          } else if (data.type === "join") {
            li.textContent = `ğŸŸ¢ ${data.sender} ãŒå…¥å®¤ã—ã¾ã—ãŸ`;
            li.style.fontStyle = "italic";
          } else if (data.type === "leave") {
            li.textContent = `ğŸ”´ ${data.sender} ãŒé€€å®¤ã—ã¾ã—ãŸ`;
            li.style.fontStyle = "italic";
          }

          chat.appendChild(li);
        };
      }

      function sendMessage() {
        const input = document.getElementById("msg");
        if (ws && input.value.trim()) {
          ws.send(input.value);
          input.value = "";
        }
      }
    </script>
  </body>
</html>
